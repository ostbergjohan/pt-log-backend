-- H2 Database Schema for PT-Log
-- Place this file in src/main/resources/

-- Drop tables if they exist (for clean initialization)
--DROP TABLE IF EXISTS PTLOG CASCADE;
--DROP TABLE IF EXISTS PTLOG_PROJEKT CASCADE;

-- Create PTLOG_PROJEKT table
CREATE TABLE PTLOG_PROJEKT (
    NAMN VARCHAR(255) PRIMARY KEY,
    BESKRIVNING VARCHAR(4000),
    ARKIVERAD INTEGER DEFAULT 0 NOT NULL CHECK (ARKIVERAD IN (0, 1))
);

-- Create PTLOG table with IDENTITY (H2 2.x syntax)
CREATE TABLE PTLOG (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DATUM TIMESTAMP NOT NULL,
    TYP VARCHAR(50) NOT NULL,
    TESTNAMN VARCHAR(255) NOT NULL,
    SYFTE VARCHAR(1000),
    ANALYS CLOB,
    PROJEKT VARCHAR(255) NOT NULL,
    TESTARE VARCHAR(255),
    MARKERA INTEGER DEFAULT 0 NOT NULL CHECK (MARKERA IN (0, 1))
);

-- Add foreign key constraint
ALTER TABLE PTLOG ADD CONSTRAINT FK_PROJEKT 
    FOREIGN KEY (PROJEKT) REFERENCES PTLOG_PROJEKT(NAMN) ON DELETE CASCADE;

-- Create indexes for better performance
CREATE INDEX IDX_PTLOG_PROJEKT ON PTLOG(PROJEKT);
CREATE INDEX IDX_PTLOG_DATUM ON PTLOG(DATUM DESC);
CREATE INDEX IDX_PTLOG_TESTNAMN ON PTLOG(TESTNAMN);
CREATE INDEX IDX_PTLOG_MARKERA ON PTLOG(MARKERA);
CREATE INDEX IDX_PTLOG_PROJEKT_ARKIVERAD ON PTLOG_PROJEKT(ARKIVERAD);